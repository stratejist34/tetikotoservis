---
// Premium X-Cross Marquee Component - Final Optimized Version
---

<section class="relative w-full h-[350px] overflow-hidden z-20">
  <!-- Band 1 - Dark (Negative Rotation) -->
  <div
    class="absolute top-1/2 left-1/2 w-[120%] -translate-x-1/2 -translate-y-1/2 -rotate-[3deg] bg-slate-900 border-y border-white/10 z-10 py-5 marquee-band-dark"
  >
    <div class="marquee-content-dark flex items-center gap-0 whitespace-nowrap">
      <div
        class="marquee-item flex items-center gap-12 px-8 text-6xl md:text-8xl font-black uppercase leading-none"
      >
        <span class="text-white">HYUNDAI</span>
        <span class="text-white/70">•</span>
        <span class="text-transparent stroke-text">KIA</span>
        <span class="text-white/70">•</span>
        <span class="text-white">TOYOTA</span>
        <span class="text-white/70">•</span>
        <span class="text-transparent stroke-text">NISSAN</span>
        <span class="text-white/70">•</span>
        <span class="text-white">HYUNDAI</span>
        <span class="text-white/70">•</span>
        <span class="text-transparent stroke-text">KIA</span>
        <span class="text-white/70">•</span>
        <span class="text-white">TOYOTA</span>
        <span class="text-white/70">•</span>
        <span class="text-transparent stroke-text">NISSAN</span>
        <span class="text-white/70">•</span>
      </div>
      <div
        class="marquee-item flex items-center gap-12 px-8 text-6xl md:text-8xl font-black uppercase leading-none"
      >
        <span class="text-white">HYUNDAI</span>
        <span class="text-white/70">•</span>
        <span class="text-transparent stroke-text">KIA</span>
        <span class="text-white/70">•</span>
        <span class="text-white">TOYOTA</span>
        <span class="text-white/70">•</span>
        <span class="text-transparent stroke-text">NISSAN</span>
        <span class="text-white/70">•</span>
        <span class="text-white">HYUNDAI</span>
        <span class="text-white/70">•</span>
        <span class="text-transparent stroke-text">KIA</span>
        <span class="text-white/70">•</span>
        <span class="text-white">TOYOTA</span>
        <span class="text-white/70">•</span>
        <span class="text-transparent stroke-text">NISSAN</span>
        <span class="text-white/70">•</span>
      </div>
    </div>
  </div>

  <!-- Band 2 - Orange (Positive Rotation) with Brand Logos -->
  <div
    class="absolute top-1/2 left-1/2 w-[120%] -translate-x-1/2 -translate-y-1/2 rotate-[3deg] bg-orange-600 shadow-xl z-20 py-4 marquee-band-orange"
  >
    <div
      class="marquee-content-orange flex items-center gap-0 whitespace-nowrap"
    >
      <div class="marquee-item flex items-center gap-16 px-8">
        <img
          src="/images/logolar/hyundai.webp"
          alt="Hyundai"
          class="w-20 md:w-28 h-auto object-contain invert brightness-0"
          width="112"
          height="56"
          loading="lazy"
        />
        <span class="text-white/70 text-4xl">•</span>
        <img
          src="/images/logolar/kia.webp"
          alt="Kia"
          class="w-20 md:w-28 h-auto object-contain invert brightness-0"
          width="112"
          height="56"
          loading="lazy"
        />
        <span class="text-white/70 text-4xl">•</span>
        <img
          src="/images/logolar/toyota.webp"
          alt="Toyota"
          class="w-20 md:w-28 h-auto object-contain invert brightness-0"
          width="112"
          height="56"
          loading="lazy"
        />
        <span class="text-white/70 text-4xl">•</span>
        <img
          src="/images/logolar/nissan.webp"
          alt="Nissan"
          class="w-20 md:w-28 h-auto object-contain invert brightness-0"
          width="112"
          height="56"
          loading="lazy"
        />
        <span class="text-white/70 text-4xl">•</span>
        <img
          src="/images/logolar/hyundai.webp"
          alt="Hyundai"
          class="w-20 md:w-28 h-auto object-contain invert brightness-0"
          width="112"
          height="56"
          loading="lazy"
        />
        <span class="text-white/70 text-4xl">•</span>
        <img
          src="/images/logolar/kia.webp"
          alt="Kia"
          class="w-20 md:w-28 h-auto object-contain invert brightness-0"
          width="112"
          height="56"
          loading="lazy"
        />
        <span class="text-white/70 text-4xl">•</span>
        <img
          src="/images/logolar/toyota.webp"
          alt="Toyota"
          class="w-20 md:w-28 h-auto object-contain invert brightness-0"
          width="112"
          height="56"
          loading="lazy"
        />
        <span class="text-white/70 text-4xl">•</span>
        <img
          src="/images/logolar/nissan.webp"
          alt="Nissan"
          class="w-20 md:w-28 h-auto object-contain invert brightness-0"
          width="112"
          height="56"
          loading="lazy"
        />
        <span class="text-white/70 text-4xl">•</span>
      </div>
      <div class="marquee-item flex items-center gap-16 px-8">
        <img
          src="/images/logolar/hyundai.webp"
          alt="Hyundai"
          class="w-20 md:w-28 h-auto object-contain invert brightness-0"
          width="112"
          height="56"
          loading="lazy"
        />
        <span class="text-white/70 text-4xl">•</span>
        <img
          src="/images/logolar/kia.webp"
          alt="Kia"
          class="w-20 md:w-28 h-auto object-contain invert brightness-0"
          width="112"
          height="56"
          loading="lazy"
        />
        <span class="text-white/70 text-4xl">•</span>
        <img
          src="/images/logolar/toyota.webp"
          alt="Toyota"
          class="w-20 md:w-28 h-auto object-contain invert brightness-0"
          width="112"
          height="56"
          loading="lazy"
        />
        <span class="text-white/70 text-4xl">•</span>
        <img
          src="/images/logolar/nissan.webp"
          alt="Nissan"
          class="w-20 md:w-28 h-auto object-contain invert brightness-0"
          width="112"
          height="56"
          loading="lazy"
        />
        <span class="text-white/70 text-4xl">•</span>
        <img
          src="/images/logolar/hyundai.webp"
          alt="Hyundai"
          class="w-20 md:w-28 h-auto object-contain invert brightness-0"
          width="112"
          height="56"
          loading="lazy"
        />
        <span class="text-white/70 text-4xl">•</span>
        <img
          src="/images/logolar/kia.webp"
          alt="Kia"
          class="w-20 md:w-28 h-auto object-contain invert brightness-0"
          width="112"
          height="56"
          loading="lazy"
        />
        <span class="text-white/70 text-4xl">•</span>
        <img
          src="/images/logolar/toyota.webp"
          alt="Toyota"
          class="w-20 md:w-28 h-auto object-contain invert brightness-0"
          width="112"
          height="56"
          loading="lazy"
        />
        <span class="text-white/70 text-4xl">•</span>
        <img
          src="/images/logolar/nissan.webp"
          alt="Nissan"
          class="w-20 md:w-28 h-auto object-contain invert brightness-0"
          width="112"
          height="56"
          loading="lazy"
        />
        <span class="text-white/70 text-4xl">•</span>
      </div>
    </div>
  </div>
</section>

<style>
  .stroke-text {
    -webkit-text-stroke: 1.5px rgba(255, 255, 255, 0.8);
    color: transparent;
  }

  /* Marquee bands */
  .marquee-band-dark,
  .marquee-band-orange {
    position: absolute;
    top: 50%;
    left: 50%;
    width: 120%;
    transform: translate(-50%, -50%);
    overflow: hidden;
    white-space: nowrap;
  }

  .marquee-band-dark {
    transform: translate(-50%, -50%) rotate(-3deg);
    background: #0f172a;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    z-index: 10;
    padding: 1.25rem 0;
  }

  .marquee-band-orange {
    transform: translate(-50%, -50%) rotate(3deg);
    background: #ea580c;
    box-shadow: 0 20px 40px -10px rgba(234, 88, 12, 0.5);
    z-index: 20;
    padding: 0.75rem 0;
  }

  .marquee-content-dark,
  .marquee-content-orange {
    display: flex;
    align-items: center;
    gap: 0;
    padding: 0 1rem;
  }

  .marquee-item {
    display: flex;
    align-items: center;
    flex-shrink: 0;
  }

  /* Logo styling */
  .marquee-band-orange img {
    filter: invert(1) brightness(0);
    transition: transform 0.3s ease;
    flex-shrink: 0;
  }

  .marquee-band-orange img:hover {
    transform: scale(1.1);
  }

  /* Logo arası boşlukları - kesin çözüm */
  .marquee-content-dark .marquee-item {
    gap: 3rem;
  }

  .marquee-content-orange .marquee-item {
    gap: 4rem;
  }

  /* Marquee item'ların genişliğini garanti altına al */
  .marquee-item {
    min-width: max-content;
  }
</style>

<script>
  import { gsap } from "gsap";
  import { ScrollTrigger } from "gsap/ScrollTrigger";

  // Marquee animasyonlarını saklamak için
  let darkTimeline: gsap.core.Timeline | null = null;
  let orangeTimeline: gsap.core.Timeline | null = null;
  let skewScrollTrigger: ScrollTrigger | null = null;

  // Initialize marquee animations with scroll velocity effect
  function initMarquee() {
    // Önceki animasyonları temizle
    if (darkTimeline) darkTimeline.kill();
    if (orangeTimeline) orangeTimeline.kill();
    if (skewScrollTrigger) skewScrollTrigger.kill();

    // Register ScrollTrigger plugin
    gsap.registerPlugin(ScrollTrigger);

    // Create timelines for each marquee
    darkTimeline = gsap.timeline({ repeat: -1, paused: false });
    orangeTimeline = gsap.timeline({ repeat: -1, paused: false });

    // Set initial speeds - %50 daha hızlı
    const baseSpeed = 0.3;
    let currentSpeed = baseSpeed;

    // Dark band (moving left)
    const darkContent = document.querySelectorAll(
      ".marquee-content-dark .marquee-item",
    );
    if (darkContent.length > 0) {
      darkTimeline.to(darkContent, {
        xPercent: -100,
        duration: 30,
        ease: "none",
        immediateRender: true,
      });
    }

    // Orange band (moving right)
    const orangeContent = document.querySelectorAll(
      ".marquee-content-orange .marquee-item",
    );
    if (orangeContent.length > 0) {
      orangeTimeline.fromTo(
        orangeContent,
        {
          xPercent: -100,
        },
        {
          xPercent: 0,
          duration: 35,
          ease: "none",
          immediateRender: true,
        },
      );
    }

    // Scroll velocity effect - daha hassas
    skewScrollTrigger = ScrollTrigger.create({
      trigger: ".marquee-band-dark, .marquee-band-orange",
      start: "top bottom",
      end: "bottom top",
      onUpdate: (self) => {
        // Get scroll velocity (pixels per second)
        const velocity = self.getVelocity();

        // Calculate speed multiplier based on velocity - daha hassas
        let speedMultiplier = 1;

        if (velocity > 0) {
          // Scrolling down - accelerate (%50 daha hızlı tepki)
          speedMultiplier = 1 + Math.min(Math.abs(velocity) / 300, 8);
        } else if (velocity < 0) {
          // Scrolling up - decelerate
          speedMultiplier = 1 - Math.min(Math.abs(velocity) / 800, 0.3);
        } else {
          // No scroll - return to base speed
          speedMultiplier = 1;
        }

        // Apply speed to both timelines
        currentSpeed = baseSpeed * speedMultiplier;
        if (darkTimeline) darkTimeline.timeScale(currentSpeed);
        if (orangeTimeline) orangeTimeline.timeScale(currentSpeed);
      },
      onRefresh: () => {
        // Reset to base speed when scroll stops
        gsap.to(
          {},
          {
            duration: 0.2,
            onUpdate: () => {
              currentSpeed = gsap.utils.interpolate(
                currentSpeed,
                baseSpeed,
                0.3,
              );
              if (darkTimeline) darkTimeline.timeScale(currentSpeed);
              if (orangeTimeline) orangeTimeline.timeScale(currentSpeed);
            },
          },
        );
      },
    });

    // Initial speed
    if (darkTimeline) darkTimeline.timeScale(baseSpeed);
    if (orangeTimeline) orangeTimeline.timeScale(baseSpeed);
  }

  // Initialize when DOM is ready
  const startSkewMarquee = () => {
    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", () => {
        setTimeout(initMarquee, 100);
      });
    } else {
      setTimeout(initMarquee, 100);
    }
  };

  startSkewMarquee();

  // ViewTransitions: Sayfa yüklendiğinde tekrar başlat
  document.addEventListener("astro:page-load", () => {
    // Kısa bir gecikme ile başlat (DOM'un hazır olması için)
    setTimeout(initMarquee, 150);
  });

  // Sayfa değişmeden önce temizlik
  document.addEventListener("astro:before-swap", () => {
    if (darkTimeline) darkTimeline.kill();
    if (orangeTimeline) orangeTimeline.kill();
    if (skewScrollTrigger) skewScrollTrigger.kill();
    darkTimeline = null;
    orangeTimeline = null;
    skewScrollTrigger = null;
  });
</script>

---
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';
import Footer from '../../components/Footer.astro';
import LocalBusinessSchema from '../../components/LocalBusinessSchema.astro';
import BreadcrumbSchema from '../../components/BreadcrumbSchema.astro';
import FAQSchema from '../../components/FAQSchema.astro';

// 1. Tüm model sayfalarını oluştur (Static Site Generation)
export async function getStaticPaths() {
  const modelEntries = await getCollection('models');
  return modelEntries.map(entry => ({
    params: { slug: entry.slug }, props: { entry },
  }));
}

// 2. Veriyi al
const { entry } = Astro.props;
const { Content } = await entry.render();
const { brand, model, metaTitle, metaDescription, image, color, faqs, features } = entry.data;

// Logo Map (Marka logoları)
const logoMap = {
  Hyundai: '/images/logolar/hyundai.webp',
  Kia: '/images/logolar/kia.webp',
  Toyota: '/images/logolar/toyota.webp',
  Nissan: '/images/logolar/nissan.webp'
};

const brandLogo = logoMap[brand];

// Renk haritası (Marka renklerini Tailwind sınıflarına çevir)
const colorMap = {
  blue: {
    bg: 'bg-blue-600',
    text: 'text-blue-600',
    border: 'border-blue-600',
    gradient: 'from-blue-900 via-blue-800 to-slate-900',
    light: 'bg-blue-50',
    hover: 'hover:bg-blue-700',
    glow: 'bg-blue-600/30'
  },
  red: {
    bg: 'bg-red-600',
    text: 'text-red-600',
    border: 'border-red-600',
    gradient: 'from-red-900 via-red-800 to-slate-900',
    light: 'bg-red-50',
    hover: 'hover:bg-red-700',
    glow: 'bg-red-600/30'
  },
  slate: {
    bg: 'bg-slate-600',
    text: 'text-slate-600',
    border: 'border-slate-600',
    gradient: 'from-slate-900 via-slate-800 to-slate-950',
    light: 'bg-slate-50',
    hover: 'hover:bg-slate-700',
    glow: 'bg-slate-600/30'
  },
  orange: {
    bg: 'bg-orange-600',
    text: 'text-orange-600',
    border: 'border-orange-600',
    gradient: 'from-orange-900 via-orange-800 to-slate-900',
    light: 'bg-orange-50',
    hover: 'hover:bg-orange-700',
    glow: 'bg-orange-600/30'
  }
};

const theme = colorMap[color];

// SEO Schemas
const breadcrumbItems = [
  { name: 'Anasayfa', url: '/' },
  { name: 'Hizmetlerimiz', url: '/hizmetlerimiz' },
  { name: `${brand} Servis`, url: `/gebze-${brand.toLowerCase()}-servis` },
  { name: `${model} Servis`, url: `/modeller/${entry.slug}` }
];
---

<Layout title={metaTitle} description={metaDescription}>
  <LocalBusinessSchema title={metaTitle} description={metaDescription} url={`https://hyundaiservisim.com/modeller/${entry.slug}`} />
  <BreadcrumbSchema items={breadcrumbItems} />
  {faqs && <FAQSchema faqs={faqs} />}

  <!-- Hero Section (Brand Page Style) -->
  <section class="relative h-[85vh] min-h-[600px] flex items-center overflow-hidden bg-slate-900">
    
    <!-- Background Image with Improved Visibility -->
    <div class="absolute inset-0 z-0">
        <img 
            src={image} 
            alt={`${brand} ${model} Servis`} 
            class="w-full h-full object-cover object-center scale-105 opacity-60 animate-slow-pan" 
        />
        <!-- Gradient Overlay: Dark to Light -->
        <div class="absolute inset-0 bg-gradient-to-r from-slate-950/90 via-slate-900/60 to-transparent"></div>
        <div class="absolute inset-0 bg-gradient-to-t from-slate-950/80 via-transparent to-transparent"></div>
    </div>

    <!-- Animated Particles/Glow -->
    <div class="absolute inset-0 z-0 opacity-30">
        <div class={`absolute top-20 right-20 w-96 h-96 ${theme.glow} rounded-full blur-[100px] animate-pulse-slow`}></div>
        <div class={`absolute bottom-20 left-20 w-72 h-72 ${theme.glow} rounded-full blur-[80px] animate-pulse-slow`} style="animation-delay: 2s;"></div>
    </div>

    <!-- Brand Logo Watermark -->
    <div class="absolute bottom-0 right-0 z-0 opacity-20 select-none pointer-events-none p-10">
        <img src={brandLogo} alt={`${brand} Logo`} class="w-44 h-auto grayscale invert" />
    </div>

    <div class="container mx-auto px-4 relative z-10">
        <div class="max-w-4xl">
            <div class={`inline-flex items-center gap-3 px-5 py-2.5 rounded-full bg-white/10 backdrop-blur-md border border-white/20 text-white mb-8 hover:bg-white/20 transition-colors cursor-default`}>
                <span class="relative flex h-3 w-3">
                  <span class={`animate-ping absolute inline-flex h-full w-full rounded-full ${theme.bg} opacity-75`}></span>
                  <span class={`relative inline-flex rounded-full h-3 w-3 ${theme.bg}`}></span>
                </span>
                <span class="font-bold tracking-wider text-sm uppercase">{brand} {model} Özel Servisi</span>
            </div>

            <h1 class="text-5xl md:text-7xl lg:text-8xl font-black text-white mb-6 leading-[1.1] tracking-tight drop-shadow-2xl">
                {model} <br/>
                <span class="text-transparent bg-clip-text bg-gradient-to-r from-white via-slate-200 to-slate-400">SERVİSİ</span>
            </h1>

            <!-- Features Tags -->
            {features && (
              <div class="flex flex-wrap gap-3 mb-10">
                {features.map(feature => (
                  <span class="px-4 py-2 bg-white/10 backdrop-blur-sm border border-white/10 rounded-xl text-white text-sm font-bold">
                    ✓ {feature}
                  </span>
                ))}
              </div>
            )}

            <div class="flex flex-col sm:flex-row gap-5">
                <a href="tel:05336157835" class={`group relative flex items-center justify-center gap-4 ${theme.bg} ${theme.hover} text-white px-8 py-5 rounded-2xl font-bold text-lg transition-all shadow-[0_0_40px_rgba(255,255,255,0.1)] hover:shadow-[0_0_60px_rgba(255,255,255,0.2)] overflow-hidden`}>
                    <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent translate-x-[-100%] group-hover:translate-x-[100%] transition-transform duration-700 skew-x-12"></div>
                    <svg class="w-6 h-6 group-hover:rotate-12 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path></svg>
                    <span>Hemen Randevu Al</span>
                </a>
            </div>
        </div>
    </div>
  </section>

  <!-- Premium Stats Bar (Overlay) -->
  <section class="relative z-20 -mt-12 container mx-auto px-4">
    <div class="bg-white rounded-3xl shadow-2xl border border-slate-100 p-8 md:p-12 grid grid-cols-2 md:grid-cols-4 gap-8 md:gap-4 divide-x-0 md:divide-x divide-slate-100">
        <div class="text-center group">
            <div class={`text-4xl md:text-5xl font-black text-slate-900 mb-2 ${theme.text} transition-colors`}>15+</div>
            <div class="text-xs font-bold text-slate-400 uppercase tracking-widest">Yıl Deneyim</div>
        </div>
        <div class="text-center group">
            <div class={`text-4xl md:text-5xl font-black text-slate-900 mb-2 ${theme.text} transition-colors`}>%100</div>
            <div class="text-xs font-bold text-slate-400 uppercase tracking-widest">Garanti</div>
        </div>
        <div class="text-center group">
            <div class={`text-4xl md:text-5xl font-black text-slate-900 mb-2 ${theme.text} transition-colors`}>5K+</div>
            <div class="text-xs font-bold text-slate-400 uppercase tracking-widest">Mutlu Müşteri</div>
        </div>
        <div class="text-center group">
            <div class={`text-4xl md:text-5xl font-black text-slate-900 mb-2 ${theme.text} transition-colors`}>7/24</div>
            <div class="text-xs font-bold text-slate-400 uppercase tracking-widest">Destek</div>
        </div>
    </div>
  </section>

  <main class="bg-white py-20">
    <div class="container mx-auto px-4">
      <div class="flex flex-col lg:flex-row gap-12">
        
        <!-- Sol Kolon: İçerik -->
        <div class="lg:w-2/3">
          <article class="prose prose-lg prose-slate max-w-none 
            prose-headings:font-black prose-headings:text-slate-900
            prose-h2:text-3xl prose-h2:mt-12 prose-h2:mb-6
            prose-p:text-slate-600 prose-p:leading-relaxed
            prose-strong:text-slate-900 prose-strong:font-bold
            prose-li:text-slate-600
            prose-img:rounded-2xl prose-img:shadow-xl">
            <Content />
          </article>

          <!-- FAQ Section -->
          {faqs && (
            <div class="mt-16">
              <h2 class="text-3xl font-black text-slate-900 mb-8">Sıkça Sorulan Sorular</h2>
              <div class="space-y-4">
                {faqs.map(faq => (
                  <div class="bg-slate-50 rounded-2xl border border-slate-100 overflow-hidden">
                    <details class="group">
                      <summary class="flex items-center justify-between p-6 font-bold text-slate-900 cursor-pointer list-none hover:bg-white transition-colors">
                        <span>{faq.question}</span>
                        <span class={`transition-transform duration-300 group-open:rotate-180 w-8 h-8 flex items-center justify-center rounded-full ${theme.light} ${theme.text}`}>
                          <svg fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="24"><path d="M6 9l6 6 6-6"></path></svg>
                        </span>
                      </summary>
                      <div class="px-6 pb-6 pt-0 bg-white">
                        <p class="text-slate-600 leading-relaxed border-t border-slate-100 pt-4">
                          {faq.answer}
                        </p>
                      </div>
                    </details>
                  </div>
                ))}
              </div>
            </div>
          )}
        </div>

        <!-- Sağ Kolon: Sticky Sidebar -->
        <aside class="lg:w-1/3">
          <div class="sticky top-32 space-y-6">
            
            <!-- Service Box -->
            <div class="bg-slate-900 rounded-3xl p-8 text-white shadow-2xl shadow-slate-900/20 relative overflow-hidden">
              <div class="absolute top-0 right-0 w-32 h-32 bg-white/5 rounded-bl-full -mr-8 -mt-8"></div>
              <h3 class="text-2xl font-bold mb-4">{brand} Uzmanı</h3>
              <p class="text-slate-300 mb-8 text-sm leading-relaxed">
                {model} aracınız için periyodik bakım, mekanik onarım ve elektronik servis hizmeti.
              </p>
              <div class="space-y-4">
                <a href="tel:05336157835" class={`flex items-center justify-center gap-3 bg-white ${theme.text} py-4 rounded-xl font-bold hover:bg-slate-50 transition-colors`}>
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path></svg>
                  Hemen Ara
                </a>
                <a href="/iletisim" class="flex items-center justify-center gap-3 bg-white/10 text-white py-4 rounded-xl font-bold hover:bg-white/20 transition-colors border border-white/10">
                  Konum Al
                </a>
              </div>
            </div>

            <!-- Quick Specs -->
            <div class="bg-slate-50 rounded-3xl p-8 border border-slate-100">
               <h3 class="font-bold text-slate-900 mb-4">Hizmet Özeti</h3>
               <ul class="space-y-3 text-sm">
                 <li class="flex items-center gap-3 text-slate-600">
                   <span class={`w-2 h-2 rounded-full ${theme.bg}`}></span>
                   Orijinal Yedek Parça
                 </li>
                 <li class="flex items-center gap-3 text-slate-600">
                   <span class={`w-2 h-2 rounded-full ${theme.bg}`}></span>
                   1 Yıl İşçilik Garantisi
                 </li>
                 <li class="flex items-center gap-3 text-slate-600">
                   <span class={`w-2 h-2 rounded-full ${theme.bg}`}></span>
                   Hızlı Arıza Tespiti
                 </li>
                 <li class="flex items-center gap-3 text-slate-600">
                   <span class={`w-2 h-2 rounded-full ${theme.bg}`}></span>
                   Uygun Fiyat Garantisi
                 </li>
               </ul>
            </div>

          </div>
        </aside>

      </div>
    </div>
  </main>
  
  <!-- CTA Banner -->
  <section class={`py-20 relative overflow-hidden ${theme.bg}`}>
     <div class="container mx-auto px-4 text-center relative z-10">
        <h2 class="text-3xl md:text-5xl font-black text-white mb-8">
           {model} Aracınız İçin En İyisi
        </h2>
        <a href="/iletisim" class="inline-flex items-center gap-3 bg-white text-slate-900 px-10 py-5 rounded-2xl font-black text-lg hover:scale-105 transition-transform shadow-2xl">
           Randevu Oluştur
        </a>
     </div>
  </section>

  <Footer />
</Layout>

<style>
  @keyframes slow-pan {
    0% { transform: scale(1.05); }
    50% { transform: scale(1.1); }
    100% { transform: scale(1.05); }
  }
  .animate-slow-pan {
    animation: slow-pan 20s infinite ease-in-out;
  }
  
  details[open] summary ~ * {
    animation: sweep .3s ease-in-out;
  }
  @keyframes sweep {
    0%    {opacity: 0; transform: translateY(-10px)}
    100%  {opacity: 1; transform: translateY(0)}
  }
  @keyframes pulse-slow {
    0%, 100% { opacity: 0.3; transform: scale(1); }
    50% { opacity: 0.5; transform: scale(1.1); }
  }
  .animate-pulse-slow {
    animation: pulse-slow 4s infinite ease-in-out;
  }
</style>